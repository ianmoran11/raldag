
<!-- README.md is generated from README.Rmd. Please edit that file -->

# raldag

<!-- badges: start -->

[![Lifecycle:
experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![Codecov test
coverage](https://codecov.io/gh/ianmoran11/raldag/branch/master/graph/badge.svg)](https://codecov.io/gh/ianmoran11/raldag?branch=master)
[![R-CMD-check](https://github.com/ianmoran11/raldag/workflows/R-CMD-check/badge.svg)](https://github.com/ianmoran11/raldag/actions)
<!-- badges: end -->

`raldag` helps you create DAGs and generate data from them.

### Specify how nodes generate data and evaluate inputs

Declare the nodes of your DAG and how data is generated by those nodes
with the following code:

``` r
c <- v("c", .f = d(~ rnorm(n = 10^4, mean = rsum(.x) + 10, sd =  4)))
a <- v("a", .f = d(~ rnorm(n = 10^4, mean = rsum(.x)     , sd =  1)))
x <- v("x", .f = d(~ rnorm(n = 10^4, mean = rsum(.x) + 30, sd =  4)))
y <- v("y", .f = d(~ rnorm(n = 10^4, mean = rsum(.x) +  7, sd =  2)))
m <- v("m", .f = d(~ rnorm(n = 10^4, mean = rsum(.x) + 40, sd =  2)))
```

In this case, the node `c` generates 1000 observations with a mean equal
to the sum of its input edges plus 10 and a standard deviation of 4.

### Declare causal connections

Causal connections between nodes as well as coefficients are specified
with the graph syntax from
[ralget](https://github.com/ianmoran11/ralget)

``` r
 (a * b(9) + m * b(1)) * x +
 (c * b(2) + m * b(5)) * y +
 (a * b(3) + c * b(5)) * m
```

<img src="man/figures/README-unnamed-chunk-6-1.png" width="100%" />

### Generate data from DAG

Now that we have a DAG with an underlying data generating process, we
can simulate data:

``` r
g %>% simulate(seed = 123)
#> # A tibble: 10,000 x 7
#>   sim_id      a     c     m     x     y label         
#>    <int>  <dbl> <dbl> <dbl> <dbl> <dbl> <chr>         
#> 1      1 -0.560 19.5   36.6  24.2  46.9 simulation set
#> 2      2 -0.230  9.33  38.9  29.0  27.1 simulation set
#> 3      3  1.56  13.7   40.5  41.9  33.4 simulation set
#> # … with 9,997 more rows
```

### Introduce interventions

We can also examine causal effects using interventions, inspired by
Pearl’s
[do-calculus](https://en.wikipedia.org/wiki/Causal_model#Do_calculus).

For example, we can set `a` to 0:

``` r
g %>% manipulate(a = 0) %>% simulate(seed = 123)
#> # A tibble: 10,000 x 7
#>   sim_id     a     c     m     x     y label         
#>    <int> <dbl> <dbl> <dbl> <dbl> <dbl> <chr>         
#> 1      1     0 19.5   38.3  29.2  46.9 simulation set
#> 2      2     0  9.33  39.6  31.0  27.1 simulation set
#> 3      3     0 13.7   35.8  27.8  33.4 simulation set
#> # … with 9,997 more rows
```

And we could compare that with what happens when `a` is set to 1:

``` r
g %>% manipulate(a = 1) %>% simulate(seed = 123)
#> # A tibble: 10,000 x 7
#>   sim_id     a     c     m     x     y label         
#>    <int> <dbl> <dbl> <dbl> <dbl> <dbl> <chr>         
#> 1      1     1 19.5   41.3  38.2  46.9 simulation set
#> 2      2     1  9.33  42.6  40.0  27.1 simulation set
#> 3      3     1 13.7   38.8  36.8  33.4 simulation set
#> # … with 9,997 more rows
```

### Compare intervention distributions

Here’s how our intervention on `a` has affected the variables in our
DAG/DGP.

``` r
bind_rows(obs, do0, do1) %>% 
  gather(var,value, -sim_id,-label) %>%
  plot_distributions()
```

<img src="man/figures/README-unnamed-chunk-11-1.png" width="100%" />

## Installation

You can install the development version from
[GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("ianmoran11/raldag")
```
